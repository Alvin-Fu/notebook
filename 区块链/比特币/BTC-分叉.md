BTC系统中的分叉(fork)
# 分叉的类型
在去中心化的系统中更改参数可能会导致出现分叉（fork）
## state fork（对系统产生了分歧）
当系统中有两个旷工同时挖到一个区块时，这是产生了一个临时性的分叉称为state fork
forking sttack分叉攻击，这是恶意攻击（deliberate fork）
## protocol fork（对协议产生了分歧）
在比特币系统中，要想进行系统升级，因为BTC是去中心化的，势必会有一些没有升级，这就导致了分叉
### hard fork（硬分叉）
如果对比特币协议进行一些新的特性或功能，这时就有一些不认可这些特性这时就导致了硬分叉
比如：
```
	比特币中区块大小的限制（blick size limit， 目前1MB），即一个区块可以存储4000个交易即（1000000/250）
	10分钟产生一个区块，这个就是4000个交易平均到10分钟即每秒可以处理7笔交易
	由于上面的原因有人提出增加这个block size limit，提高这个交易量
	如果系统中大多数都愿意增加这个限制（大多数指的是系统中的大多数算力）
	这个时候就会出现有一部分节点只认可原来的区块，新的节点会认可旧的节点
	如果少部分永远不升级这个分叉就永远存在
	区块大小不是越大越好，因为比特币中的传输是很耗费带宽的
```
在分叉之前产生的币就会将一个变成了两个了，因为分叉的两个链都认可之前的币
在交易中通过在另一条链上进行回放：B转账给C，然后在另一条链上进行回放，导致C收到了两笔钱
### 软分叉（soft fork）
临时性的分叉
实际中出现的软分叉的例子：
给没有定义的域赋予新的属性，比如coinbase域的使用， 将UTXO组成一个merkle tree，由于coinbase的值会影响根hash

BTC历史上的软分叉的例子：P2SH: pay to script hash
	在支付的时候不是付给一个pubilc key的hash而是一个赎回脚本的hash（redeem script）
	验证分为两步：
		1. 验证输入脚本中的redeem script和输出脚本的redeem script的hash是对的上的
		2. 执行redeem script验证输入脚本给出的这些签名是正确的
	对于旧节点不理解P2SH的特性只会验证第一阶段，纠




merkle proof用于证明某个交易是否在一个给定的区块里，轻节点向全节点请求验证这个交易，这时全节点会将返回一个merkle proof

